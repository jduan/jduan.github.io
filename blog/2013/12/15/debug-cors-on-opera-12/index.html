
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Debug CORS on Opera 12 - Furious Programming</title>
  <meta name="author" content="Jingjing Duan">

  
  <meta name="description" content="Today, I encountered a strange problem with CORS
(cross-origin resource sharing) on Opera 12. (we have been porting our
JS application to work on a &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jduan.github.io/blog/2013/12/15/debug-cors-on-opera-12">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Furious Programming" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Furious Programming</a></h1>
  
    <h2>A passionate programmer's journey</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jduan.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Debug CORS on Opera 12</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-15T13:59:46-08:00" pubdate data-updated="true">Dec 15<span>th</span>, 2013</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://jduan.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Today, I encountered a strange problem with <a href="www.w3.org/TR/cors/">CORS</a>
(cross-origin resource sharing) on Opera 12. (we have been porting our
JS application to work on a device that runs Opera 12)</p>

<p>We have a central Authentication service that authenticates users
and this application is one of the clients. The symptom is when this
application talks to the Authentication service (via a POST request) it
keeps getting a zero HTTP status code. In generally, when a browser returns a
zero status code, it means the browser cancelled the request for some reason.</p>

<!-- more -->


<p>Why could Opera cancel a request to the Authentication service? (Note
that our application works fine on Chrome). Upon reading docs of CORS, I
realize that certain CORS requests (say POST) require a <strong>preflight</strong> request
before actually issuing the real request. Maybe it is this &ldquo;preflight&rdquo;
request that keeps failing and it prevents Opera from issuing a real
POST request?</p>

<p>To see the traffic between the application and the Authentication service, I ran
a &ldquo;nodejs proxy&rdquo; between them which simply logs all the requests and responses.
The logs confirm that Opera only sends a preflight request but doesn&rsquo;t send a
real POST request.</p>

<p>Why? Is it possible that the Authentication service doesn&rsquo;t implement the CORS
standard properly? Let&rsquo;s check the related headers. The following are the
response headers related to CORS:</p>

<ul>
<li>Access-Control-Allow-Origin</li>
<li>Access-Control-Max-Age</li>
<li>Access-Control-Allow-Credentials</li>
<li>Access-Control-Allow-Methods</li>
<li>Access-Control-Allow-Headers</li>
</ul>


<p>The Authentication service returns the following headers:</p>

<ul>
<li>Access-Control-Allow-Origin: the-origin-of-our-app</li>
<li>Access-Control-Max-Age: this header isn&rsquo;t set</li>
<li>Access-Control-Allow-Credentials: true</li>
<li>Access-Control-Allow-Methods: POST, GET, OPTIONS</li>
<li>Access-Control-Allow-Headers: a lot of headers including Authentication</li>
</ul>


<p>It seems all the headers make sense. Why does our app work on Chrome, but not
Opera? Eventually the HTTP status code for the preflight request caught my eyes.
The Authentication service returns <strong>204</strong> for the preflight request. Accordingly to
HTTP standard, <strong>2xx</strong> codes generally mean success. <strong>However, all previous versions
of the CORS standard (<a href="http://www.w3.org/TR/cors/">http://www.w3.org/TR/cors/</a>) except the latest (12/05/2013)
mandate only 200 means success.</strong> In other words, 204 would mean a failure, which
is why Opera believes the preflight request failed and refuses to send a real
POST request.</p>

<p>Opera is obviously still complying with the previous versions of the
CORS standard, which is reasonable considering the latest version of the CORS
standard only came out a few days ago. It takes time to catch up with
the ever-evolving CORS standard.</p>

<p>Chrome, on the other hand, seems to treat any 2xx codes as success. Either they
are extremely up to date or they&rsquo;ve always treated 2xx codes as success.</p>

<p>The moral of the story is the specs of a standard is every important and
contains pretty much everything you need. Read it carefully.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jingjing Duan</span></span>

      








  


<time datetime="2013-12-15T13:59:46-08:00" pubdate data-updated="true">Dec 15<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/web/'>Web</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://jduan.github.io/blog/2013/12/15/debug-cors-on-opera-12/" data-via="" data-counturl="http://jduan.github.io/blog/2013/12/15/debug-cors-on-opera-12/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
      
        <a class="basic-alignment right" href="/blog/2013/12/15/tcpdump-on-localhost/" title="Next Post: tcpdump on localhost">tcpdump on localhost &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/01/03/closures-in-python/">Closures in Python</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/16/one-beautiful-aspect-of-immutable-data-structures/">One Beautiful Aspect of Immutable Data Structures</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/15/tcpdump-on-localhost/">Tcpdump on Localhost</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/15/debug-cors-on-opera-12/">Debug CORS on Opera 12</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/jduan">@jduan</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'jduan',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Jingjing Duan -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'jduan-github-io';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://jduan.github.io/blog/2013/12/15/debug-cors-on-opera-12/';
        var disqus_url = 'http://jduan.github.io/blog/2013/12/15/debug-cors-on-opera-12/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
